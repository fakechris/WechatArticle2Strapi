# 🖼️ 头图自动上传功能指南

## 📖 功能概述

头图自动上传功能是 Enhanced Article Extractor v0.3.0 的重要新特性，它能够自动选择文章中的图片作为头图/封面图，上传到Strapi媒体库，并自动关联到文章记录。

## ✨ 核心特性

- **🎯 智能选择**: 根据配置的索引自动选择文章中的图片
- **📤 自动上传**: 头图直接上传到Strapi媒体库
- **🔗 自动关联**: 媒体文件ID自动写入指定的头图字段
- **🏷️ 智能命名**: 基于文章标题生成有意义的文件名
- **🔧 图片优化**: 支持图片压缩和尺寸调整
- **⚡ 错误处理**: 优雅的错误处理，不影响文章提取主流程

## 🔧 配置步骤

### 1. 在Strapi中创建头图字段

首先在你的Strapi集合中添加头图字段：

```javascript
// 在 Article 集合中添加
{
  head_img: {
    type: 'media',
    multiple: false,  // 单个文件
    required: false,  // 可选字段
    allowedTypes: ['images']  // 只允许图片
  }
}
```

### 2. 配置字段映射

在扩展设置页面配置头图字段映射：

1. 打开扩展设置：右键扩展图标 → "选项"
2. 导航到 **"🔗 Field Mapping"** 部分
3. 启用 ✅ **"Enable custom field mapping"**
4. 在 **"🖼️ Head Image Field"** 部分：
   - 输入Strapi中的头图字段名（如：`head_img`）

### 3. 启用头图上传功能

在高级设置中启用头图功能：

1. 在设置页面导航到 **"⚙️ Advanced Settings"** 部分
2. 启用 ✅ **"自动上传文章头图"**
3. 配置 **"头图选择索引"**：
   - `0` = 第1张图片
   - `1` = 第2张图片
   - 以此类推...

## 🎯 使用流程

### 操作步骤

1. **配置完成后**，正常使用扩展：
   - 访问任意文章页面
   - 点击扩展图标
   - 预览提取的内容和头图

2. **检查头图选择**：
   - 扩展会显示将要作为头图的图片
   - 确认选择的图片是否合适

3. **一键保存**：
   - 点击"Save to Strapi"
   - 扩展会自动处理头图上传和文章创建

## 📋 调试和故障排除

### 检查配置

如果头图没有生成，请检查以下配置：

1. **字段映射检查**：
   ```javascript
   // 在Console中查看日志
   🖼️ 头图配置检查: {
     uploadHeadImg: true,      // 应该为 true
     headImgIndex: 0,          // 图片索引
     hasImages: true,          // 文章有图片
     imageCount: 3,            // 图片数量
     headImgField: "head_img"  // 字段名称已配置
   }
   ```

2. **头图处理日志**：
   ```javascript
   🖼️ 开始处理头图...
   🎯 选择第 1 张图片作为头图: https://...
   📤 上传头图到Strapi: head-img-article-title-1234567.jpg
   ✨ 头图上传成功: head-img-article-title-1234567.jpg (ID: 42)
   🖼️ 设置头图: head_img = 42
   ```

### 常见问题

| 问题 | 原因 | 解决方案 |
|------|------|----------|
| 头图字段为空 | 字段映射未配置 | 在"Field Mapping"中配置`head_img`字段 |
| 没有处理日志 | 头图功能未启用 | 在"Advanced Settings"中启用头图上传 |
| 图片索引越界 | 指定索引的图片不存在 | 检查图片数量，调整索引值 |
| 上传失败 | 网络或权限问题 | 检查Strapi连接和Token权限 |

### 调试模式

如需更详细的调试信息，可以：

1. 打开Chrome开发者工具 (F12)
2. 切换到"Console"标签
3. 使用扩展时观察日志输出
4. 寻找包含 `🖼️` 的头图相关日志

## 🎨 文件命名规则

自动生成的头图文件名格式：

```
head-img-{article-title-slug}-{timestamp}-{random-id}.{extension}

示例：
- head-img-ai-technology-trends-1703267890123-a4b5c6.jpg
- head-img-javascript-guide-1703267890456-x1y2z3.png
```

## 📊 性能优化

### 图片处理优化

头图处理会自动应用以下优化：

- **压缩**: 默认质量 0.8，平衡文件大小和质量
- **尺寸限制**: 
  - 最大宽度: 1200px
  - 最大高度: 800px
- **格式支持**: JPG, PNG, WebP等主流格式

## 🔄 版本更新记录

### v0.3.0 (2024-12-22)
- ✨ 新增：头图自动上传功能
- 🔧 新增：头图字段映射配置
- 🖼️ 新增：智能文件命名
- 🐛 修复：配置界面重复字段
- 📝 新增：详细调试日志

## 🎯 最佳实践

### 头图选择建议

1. **索引选择**：
   - 通常第1张图片（索引0）效果最好
   - 对于微信文章，可能需要跳过二维码图片

2. **图片质量**：
   - 选择高清、相关性强的图片
   - 避免选择纯文字或低质量图片

### 批量处理建议

如果需要批量处理大量文章：

1. 检查Strapi媒体库存储空间
2. 考虑设置合理的图片质量和尺寸
3. 监控上传性能和成功率
4. 定期清理无关联的媒体文件

## 📚 相关文档

- [📖 快速开始指南](QUICK_START_GUIDE.md)
- [🔗 字段映射指南](FIELD_MAPPING_GUIDE.md)
- [🚀 功能增强摘要](ENHANCEMENT_SUMMARY.md)
- [🎯 使用示例](USAGE_EXAMPLES.md)

---

💡 **提示**: 头图功能与现有的图片上传功能完全兼容，可以同时使用。头图会额外处理并关联到专门的头图字段，不影响文章内容中的图片处理。