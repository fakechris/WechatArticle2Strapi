# CLI头图尺寸检查功能更新

## 📋 更新概述

CLI工具现在支持头图尺寸检查功能！当第一张图片不符合尺寸要求时，系统会自动寻找后续符合条件的图片作为头图。

## 🔧 新增功能

### 1. 智能头图选择
- **尺寸要求**: 宽度 ≥ 200px 且 高度 ≥ 200px
- **自动搜索**: 从指定索引开始，依次检查每张图片的尺寸
- **优雅降级**: 如果没有找到符合要求的图片，跳过头图设置并记录错误

### 2. 新增方法
- `getImageDimensions(imageUrl)` - 使用Sharp获取图片实际尺寸
- `isValidHeadImage(imageUrl, minWidth, minHeight)` - 检查图片是否符合尺寸要求
- `findValidHeadImage(images, minWidth, minHeight)` - 查找符合要求的头图

### 3. 处理逻辑
1. 检查用户指定索引的图片
2. 如果符合尺寸要求，使用该图片
3. 如果不符合，依次检查后续图片
4. 找到第一个符合要求的图片作为头图
5. 如果都不符合要求，跳过头图处理

## 🎯 使用示例

```bash
# 使用头图功能（会自动选择符合尺寸要求的图片）
article-extractor-v2 "https://mp.weixin.qq.com/s/example" \
  --strapi \
  --head-image \
  --head-image-index 0 \
  --verbose

# 示例输出：
# 🎯 查找符合尺寸要求的头图 (最小: 200x200)
# 🎯 检查指定的头图索引 0...
# 📏 图片尺寸检查: https://example.com/small.jpg...
#    尺寸: 100x80, 要求: 200x200, 符合: ❌
# ❌ 指定索引的图片不符合尺寸要求，将搜索其他图片...
# 📸 检查第 2 张图片...
# 📏 图片尺寸检查: https://example.com/large.jpg...
#    尺寸: 800x600, 要求: 200x200, 符合: ✅
# ✅ 找到符合要求的头图: 索引 1, 尺寸 800x600
```

## 📁 修改文件
- `cli/src/extractor.js` - 主要的修改文件
- `cli/test-head-image.js` - 新增测试文件

## 🔍 技术细节

### 依赖包
使用现有的`sharp`包来获取图片尺寸，无需额外安装依赖。

### 错误处理
- 图片下载失败：记录错误，继续检查下一张图片
- 尺寸检测失败：视为不符合要求，继续搜索
- 网络超时：设置10秒超时，避免长时间等待

### 性能优化
- 只下载必要的图片数据用于尺寸检测
- 使用axios的arraybuffer响应类型
- 设置合理的超时时间

## ✅ 向后兼容性

- 保持原有的`--head-image-index`参数功能
- 如果指定索引的图片符合要求，优先使用
- 只有在不符合要求时才会搜索其他图片
- 不会影响现有的配置和使用方式

## 🧪 测试

运行测试文件验证功能：
```bash
cd cli
node test-head-image.js
```

## 📊 统计信息

处理完成后，头图信息会包含：
- `selectedIndex`: 实际选择的图片索引
- `originalDimensions`: 原图尺寸信息
- `originalIndex`: 用户指定的索引（如果有）

这样可以清楚地知道系统最终选择了哪张图片作为头图。

---

**版本**: 0.5.1+  
**更新日期**: 2024年最新  
**兼容性**: Node.js >= 16.0.0 