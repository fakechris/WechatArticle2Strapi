# CLIå¤´å›¾å°ºå¯¸æ£€æŸ¥åŠŸèƒ½æ›´æ–°

## ðŸ“‹ æ›´æ–°æ¦‚è¿°

CLIå·¥å…·çŽ°åœ¨æ”¯æŒå¤´å›¾å°ºå¯¸æ£€æŸ¥åŠŸèƒ½ï¼å½“ç¬¬ä¸€å¼ å›¾ç‰‡ä¸ç¬¦åˆå°ºå¯¸è¦æ±‚æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¯»æ‰¾åŽç»­ç¬¦åˆæ¡ä»¶çš„å›¾ç‰‡ä½œä¸ºå¤´å›¾ã€‚

## ðŸ”§ æ–°å¢žåŠŸèƒ½

### 1. æ™ºèƒ½å¤´å›¾é€‰æ‹©
- **å°ºå¯¸è¦æ±‚**: å®½åº¦ â‰¥ 200px ä¸” é«˜åº¦ â‰¥ 200px
- **è‡ªåŠ¨æœç´¢**: ä»ŽæŒ‡å®šç´¢å¼•å¼€å§‹ï¼Œä¾æ¬¡æ£€æŸ¥æ¯å¼ å›¾ç‰‡çš„å°ºå¯¸
- **ä¼˜é›…é™çº§**: å¦‚æžœæ²¡æœ‰æ‰¾åˆ°ç¬¦åˆè¦æ±‚çš„å›¾ç‰‡ï¼Œè·³è¿‡å¤´å›¾è®¾ç½®å¹¶è®°å½•é”™è¯¯

### 2. æ–°å¢žæ–¹æ³•
- `getImageDimensions(imageUrl)` - ä½¿ç”¨SharpèŽ·å–å›¾ç‰‡å®žé™…å°ºå¯¸
- `isValidHeadImage(imageUrl, minWidth, minHeight)` - æ£€æŸ¥å›¾ç‰‡æ˜¯å¦ç¬¦åˆå°ºå¯¸è¦æ±‚
- `findValidHeadImage(images, minWidth, minHeight)` - æŸ¥æ‰¾ç¬¦åˆè¦æ±‚çš„å¤´å›¾

### 3. å¤„ç†é€»è¾‘
1. æ£€æŸ¥ç”¨æˆ·æŒ‡å®šç´¢å¼•çš„å›¾ç‰‡
2. å¦‚æžœç¬¦åˆå°ºå¯¸è¦æ±‚ï¼Œä½¿ç”¨è¯¥å›¾ç‰‡
3. å¦‚æžœä¸ç¬¦åˆï¼Œä¾æ¬¡æ£€æŸ¥åŽç»­å›¾ç‰‡
4. æ‰¾åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„å›¾ç‰‡ä½œä¸ºå¤´å›¾
5. å¦‚æžœéƒ½ä¸ç¬¦åˆè¦æ±‚ï¼Œè·³è¿‡å¤´å›¾å¤„ç†

## ðŸŽ¯ ä½¿ç”¨ç¤ºä¾‹

```bash
# ä½¿ç”¨å¤´å›¾åŠŸèƒ½ï¼ˆä¼šè‡ªåŠ¨é€‰æ‹©ç¬¦åˆå°ºå¯¸è¦æ±‚çš„å›¾ç‰‡ï¼‰
article-extractor-v2 "https://mp.weixin.qq.com/s/example" \
  --strapi \
  --head-image \
  --head-image-index 0 \
  --verbose

# ç¤ºä¾‹è¾“å‡ºï¼š
# ðŸŽ¯ æŸ¥æ‰¾ç¬¦åˆå°ºå¯¸è¦æ±‚çš„å¤´å›¾ (æœ€å°: 200x200)
# ðŸŽ¯ æ£€æŸ¥æŒ‡å®šçš„å¤´å›¾ç´¢å¼• 0...
# ðŸ“ å›¾ç‰‡å°ºå¯¸æ£€æŸ¥: https://example.com/small.jpg...
#    å°ºå¯¸: 100x80, è¦æ±‚: 200x200, ç¬¦åˆ: âŒ
# âŒ æŒ‡å®šç´¢å¼•çš„å›¾ç‰‡ä¸ç¬¦åˆå°ºå¯¸è¦æ±‚ï¼Œå°†æœç´¢å…¶ä»–å›¾ç‰‡...
# ðŸ“¸ æ£€æŸ¥ç¬¬ 2 å¼ å›¾ç‰‡...
# ðŸ“ å›¾ç‰‡å°ºå¯¸æ£€æŸ¥: https://example.com/large.jpg...
#    å°ºå¯¸: 800x600, è¦æ±‚: 200x200, ç¬¦åˆ: âœ…
# âœ… æ‰¾åˆ°ç¬¦åˆè¦æ±‚çš„å¤´å›¾: ç´¢å¼• 1, å°ºå¯¸ 800x600
```

## ðŸ“ ä¿®æ”¹æ–‡ä»¶
- `cli/src/extractor.js` - ä¸»è¦çš„ä¿®æ”¹æ–‡ä»¶
- `cli/test-head-image.js` - æ–°å¢žæµ‹è¯•æ–‡ä»¶

## ðŸ” æŠ€æœ¯ç»†èŠ‚

### ä¾èµ–åŒ…
ä½¿ç”¨çŽ°æœ‰çš„`sharp`åŒ…æ¥èŽ·å–å›¾ç‰‡å°ºå¯¸ï¼Œæ— éœ€é¢å¤–å®‰è£…ä¾èµ–ã€‚

### é”™è¯¯å¤„ç†
- å›¾ç‰‡ä¸‹è½½å¤±è´¥ï¼šè®°å½•é”™è¯¯ï¼Œç»§ç»­æ£€æŸ¥ä¸‹ä¸€å¼ å›¾ç‰‡
- å°ºå¯¸æ£€æµ‹å¤±è´¥ï¼šè§†ä¸ºä¸ç¬¦åˆè¦æ±‚ï¼Œç»§ç»­æœç´¢
- ç½‘ç»œè¶…æ—¶ï¼šè®¾ç½®10ç§’è¶…æ—¶ï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…

### æ€§èƒ½ä¼˜åŒ–
- åªä¸‹è½½å¿…è¦çš„å›¾ç‰‡æ•°æ®ç”¨äºŽå°ºå¯¸æ£€æµ‹
- ä½¿ç”¨axiosçš„arraybufferå“åº”ç±»åž‹
- è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´

## âœ… å‘åŽå…¼å®¹æ€§

- ä¿æŒåŽŸæœ‰çš„`--head-image-index`å‚æ•°åŠŸèƒ½
- å¦‚æžœæŒ‡å®šç´¢å¼•çš„å›¾ç‰‡ç¬¦åˆè¦æ±‚ï¼Œä¼˜å…ˆä½¿ç”¨
- åªæœ‰åœ¨ä¸ç¬¦åˆè¦æ±‚æ—¶æ‰ä¼šæœç´¢å…¶ä»–å›¾ç‰‡
- ä¸ä¼šå½±å“çŽ°æœ‰çš„é…ç½®å’Œä½¿ç”¨æ–¹å¼

## ðŸ§ª æµ‹è¯•

è¿è¡Œæµ‹è¯•æ–‡ä»¶éªŒè¯åŠŸèƒ½ï¼š
```bash
cd cli
node test-head-image.js
```

## ðŸ“Š ç»Ÿè®¡ä¿¡æ¯

å¤„ç†å®ŒæˆåŽï¼Œå¤´å›¾ä¿¡æ¯ä¼šåŒ…å«ï¼š
- `selectedIndex`: å®žé™…é€‰æ‹©çš„å›¾ç‰‡ç´¢å¼•
- `originalDimensions`: åŽŸå›¾å°ºå¯¸ä¿¡æ¯
- `originalIndex`: ç”¨æˆ·æŒ‡å®šçš„ç´¢å¼•ï¼ˆå¦‚æžœæœ‰ï¼‰

è¿™æ ·å¯ä»¥æ¸…æ¥šåœ°çŸ¥é“ç³»ç»Ÿæœ€ç»ˆé€‰æ‹©äº†å“ªå¼ å›¾ç‰‡ä½œä¸ºå¤´å›¾ã€‚

---

**ç‰ˆæœ¬**: 0.5.1+  
**æ›´æ–°æ—¥æœŸ**: 2024å¹´æœ€æ–°  
**å…¼å®¹æ€§**: Node.js >= 16.0.0 