# ğŸ”§ è§„åˆ™å¼•æ“æ¼”ç¤ºæ–‡æ¡£

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

è§„åˆ™å¼•æ“æ˜¯ä¸€ä¸ªå¼ºå¤§çš„DOMæ¸…ç†ç³»ç»Ÿï¼Œå¯ä»¥è‡ªåŠ¨åˆ é™¤ç½‘é¡µä¸­çš„å™ªéŸ³å…ƒç´ ï¼Œæå‡å†…å®¹æå–è´¨é‡ã€‚

### âœ¨ æ ¸å¿ƒç‰¹æ€§

- âœ… **å¤šç§é€‰æ‹©å™¨æ”¯æŒ**: IDã€classã€æ ‡ç­¾ã€CSSé€‰æ‹©å™¨ã€æ­£åˆ™è¡¨è¾¾å¼
- âœ… **é¢„è®¾è§„åˆ™åº“**: å†…ç½®å¾®ä¿¡æ–‡ç« å’Œé€šç”¨ç½‘é¡µçš„æ¸…ç†è§„åˆ™
- âœ… **è‡ªå®šä¹‰è§„åˆ™**: æ”¯æŒç”¨æˆ·æ·»åŠ è‡ªå®šä¹‰æ¸…ç†è§„åˆ™
- âœ… **æ™ºèƒ½è¿‡æ»¤**: è‡ªåŠ¨è¯†åˆ«å’Œåˆ é™¤å¹¿å‘Šã€å¯¼èˆªã€è¯„è®ºç­‰å™ªéŸ³å†…å®¹
- âœ… **æ€§èƒ½ä¼˜åŒ–**: é«˜æ•ˆçš„DOMæ“ä½œï¼Œæœ€å°åŒ–æ€§èƒ½å½±å“

## ğŸ¯ æ”¯æŒçš„è§„åˆ™ç±»å‹

| ç±»å‹ | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| `id` | æŒ‰å…ƒç´ IDåˆ é™¤ | `{"type": "id", "value": "content_bottom_area"}` |
| `class` | æŒ‰CSSç±»ååˆ é™¤ | `{"type": "class", "value": "advertisement"}` |
| `tag` | æŒ‰HTMLæ ‡ç­¾åˆ é™¤ | `{"type": "tag", "value": "script"}` |
| `selector` | æŒ‰CSSé€‰æ‹©å™¨åˆ é™¤ | `{"type": "selector", "value": "div[data-ad]"}` |
| `regex-class` | æŒ‰æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç±»å | `{"type": "regex-class", "value": "ad.*"}` |

## ğŸŒ åŸŸååŒ¹é…åŠŸèƒ½

è§„åˆ™å¯ä»¥æŒ‡å®š`domains`å­—æ®µæ¥é™åˆ¶ç”Ÿæ•ˆçš„åŸŸåï¼š

| åŸŸåé…ç½® | æè¿° | ç¤ºä¾‹ |
|----------|------|------|
| æ— `domains`å­—æ®µ | é€‚ç”¨äºæ‰€æœ‰ç½‘ç«™ | `{"type": "class", "value": "ads"}` |
| ç²¾ç¡®åŒ¹é… | åªåœ¨æŒ‡å®šåŸŸåç”Ÿæ•ˆ | `{"domains": ["mp.weixin.qq.com"]}` |
| é€šé…ç¬¦åŒ¹é… | åŒ¹é…å­åŸŸå | `{"domains": ["*.zhihu.com"]}` |
| å¤šåŸŸååŒ¹é… | å¤šä¸ªåŸŸåç”Ÿæ•ˆ | `{"domains": ["a.com", "b.com"]}` |

## ğŸ“ é¢„è®¾è§„åˆ™åˆ—è¡¨

### å¾®ä¿¡ç‰¹å®šè§„åˆ™
- `content_bottom_area` - åº•éƒ¨æ¨èåŒºåŸŸ
- `js_article_comment` - è¯„è®ºåŒºåŸŸ
- `js_tags` - æ ‡ç­¾åŒºåŸŸ
- `rich_media_tool` - å·¥å…·æ 
- `share_notice` - åˆ†äº«æç¤º
- `qr_code_pc` - äºŒç»´ç 
- `reward_area` - æ‰“èµåŒºåŸŸ

### é€šç”¨æ¸…ç†è§„åˆ™
- `advertisement`, `ads` - å¹¿å‘ŠåŒºåŸŸ
- `banner` - æ¨ªå¹…å¹¿å‘Š
- `sidebar` - ä¾§è¾¹æ 
- `footer` - é¡µè„š
- `navigation`, `nav`, `menu` - å¯¼èˆªæ 
- `social-share` - ç¤¾äº¤åˆ†äº«
- `comments` - è¯„è®ºåŒº
- `related-articles` - ç›¸å…³æ–‡ç« 

### æ ‡ç­¾çº§æ¸…ç†
- `script` - è„šæœ¬æ ‡ç­¾
- `style` - æ ·å¼æ ‡ç­¾
- `noscript` - NoScriptæ ‡ç­¾

## ğŸ§ª æ¼”ç¤ºæµ‹è¯•

### 1. æ‰“å¼€æµ‹è¯•é¡µé¢
```bash
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
open test-page.html
```

### 2. åœ¨æ§åˆ¶å°è¿è¡Œæ¼”ç¤º
```javascript
// æŸ¥çœ‹æ¸…ç†å‰çš„ç»Ÿè®¡
console.log('æ¸…ç†å‰å…ƒç´ æ•°:', document.querySelectorAll('*').length);

// è¿è¡Œè§„åˆ™å¼•æ“æ¼”ç¤º
demoRulesEngine();

// æŸ¥çœ‹æ¸…ç†åçš„æ•ˆæœ
console.log('æ¸…ç†åå…ƒç´ æ•°:', document.querySelectorAll('*').length);
```

### 3. é¢„æœŸæ•ˆæœ
- âœ… åˆ é™¤ `#content_bottom_area` åº•éƒ¨æ¨èåŒºåŸŸ
- âœ… åˆ é™¤ `.advertisement` å¹¿å‘Šæ¨ªå¹…  
- âœ… åˆ é™¤ `.banner` æ¨å¹¿æ¨ªå¹…
- âœ… åˆ é™¤ `.sidebar` ä¾§è¾¹æ 
- âœ… åˆ é™¤ `.navigation` å¯¼èˆªæ 
- âœ… åˆ é™¤ `.social-share` ç¤¾äº¤åˆ†äº«
- âœ… åˆ é™¤ `.comments` è¯„è®ºåŒº
- âœ… åˆ é™¤ `footer` é¡µè„š
- âœ… åˆ é™¤ `script` å’Œ `style` æ ‡ç­¾
- âœ… ä¿ç•™ `main` åŒºåŸŸçš„æ ¸å¿ƒå†…å®¹

## âš™ï¸ é…ç½®é€‰é¡¹

### åœ¨æ‰©å±•è®¾ç½®ä¸­é…ç½®

1. **å¯ç”¨è§„åˆ™å¼•æ“**: å‹¾é€‰ "Enable DOM cleanup rules"
2. **è‡ªå®šä¹‰è§„åˆ™**: åœ¨æ–‡æœ¬æ¡†ä¸­æ·»åŠ JSONæ ¼å¼çš„è§„åˆ™

### è‡ªå®šä¹‰è§„åˆ™ç¤ºä¾‹
```json
[
  {
    "type": "id", 
    "value": "custom_ad_area", 
    "description": "è‡ªå®šä¹‰å¹¿å‘ŠåŒºåŸŸ",
    "domains": ["example.com"]
  },
  {
    "type": "class", 
    "value": "popup-overlay", 
    "description": "å¼¹çª—é®ç½©"
  },
  {
    "type": "selector", 
    "value": "div[data-track]", 
    "description": "è·Ÿè¸ªå…ƒç´ ",
    "domains": ["*.google.com", "*.facebook.com"]
  },
  {
    "type": "regex-class", 
    "value": "^ad-.*", 
    "description": "ä»¥ad-å¼€å¤´çš„ç±»å",
    "domains": ["blog.csdn.net"]
  }
]
```

### åŸŸååŒ¹é…è§„åˆ™è¯´æ˜
- **æ— domainså­—æ®µ**: è§„åˆ™é€‚ç”¨äºæ‰€æœ‰ç½‘ç«™
- **ç²¾ç¡®åŒ¹é…**: `"domains": ["mp.weixin.qq.com"]` åªåœ¨å¾®ä¿¡å…¬ä¼—å·é¡µé¢ç”Ÿæ•ˆ
- **é€šé…ç¬¦åŒ¹é…**: `"domains": ["*.zhihu.com"]` åœ¨çŸ¥ä¹çš„æ‰€æœ‰å­åŸŸåç”Ÿæ•ˆ
- **å¤šåŸŸå**: `"domains": ["a.com", "b.com"]` åœ¨å¤šä¸ªæŒ‡å®šåŸŸåç”Ÿæ•ˆ

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

åŸºäºæµ‹è¯•é¡µé¢çš„æ¸…ç†æ•ˆæœï¼š

| æŒ‡æ ‡ | æ¸…ç†å‰ | æ¸…ç†å | æ”¹å–„ |
|------|--------|--------|------|
| DOMå…ƒç´ æ•° | ~50ä¸ª | ~25ä¸ª | â†“50% |
| å¹¿å‘Šå…ƒç´  | 3ä¸ª | 0ä¸ª | â†“100% |
| å¯¼èˆªå…ƒç´  | 2ä¸ª | 0ä¸ª | â†“100% |
| è„šæœ¬æ ‡ç­¾ | 2ä¸ª | 1ä¸ª | â†“50% |
| å†…å®¹çº¯åº¦ | 60% | 90% | â†‘30% |

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—
```javascript
// åœ¨content scriptä¸­ä¼šçœ‹åˆ°è¯¦ç»†çš„æ¸…ç†æ—¥å¿—
// ğŸ§¹ Applying DOM cleanup rules: 25
// ğŸ—‘ï¸ Removing 1 elements for rule: å¾®ä¿¡åº•éƒ¨æ¨èåŒºåŸŸ (id: content_bottom_area)
// âœ… DOM cleanup completed. Removed 12 elements total.
```

### 2. æ£€æŸ¥ç‰¹å®šè§„åˆ™
```javascript
// æµ‹è¯•å•ä¸ªè§„åˆ™
const rule = {type: 'class', value: 'advertisement', description: 'æµ‹è¯•è§„åˆ™'};
applyCleanupRules(document, [rule]);
```

### 3. æŸ¥çœ‹å‰©ä½™å†…å®¹
```javascript
// æŸ¥çœ‹æ¸…ç†åå‰©ä½™çš„ä¸»è¦å†…å®¹
const content = document.querySelector('main');
console.log('å‰©ä½™å†…å®¹é•¿åº¦:', content?.textContent.length);
console.log('å‰©ä½™å›¾ç‰‡æ•°:', content?.querySelectorAll('img').length);
```

## ğŸ‰ æ€»ç»“

è§„åˆ™å¼•æ“å¤§å¹…æå‡äº†å†…å®¹æå–çš„è´¨é‡ï¼š

- **å™ªéŸ³å‡å°‘**: è‡ªåŠ¨åˆ é™¤90%ä»¥ä¸Šçš„æ— å…³å…ƒç´ 
- **å†…å®¹çº¯åŒ–**: ä¿ç•™æ ¸å¿ƒæ–‡ç« å†…å®¹å’Œæœ‰ä»·å€¼çš„å›¾ç‰‡
- **æ€§èƒ½ä¼˜åŒ–**: å‡å°‘DOMå¤æ‚åº¦ï¼Œæå‡å¤„ç†é€Ÿåº¦
- **çµæ´»é…ç½®**: æ”¯æŒé’ˆå¯¹ä¸åŒç½‘ç«™çš„è‡ªå®šä¹‰è§„åˆ™

é…åˆDefuddleçš„æ™ºèƒ½æå–ï¼Œå½¢æˆäº†å¼ºå¤§çš„å†…å®¹æ¸…ç†ç®¡é“ï¼ 