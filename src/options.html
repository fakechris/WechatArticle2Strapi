<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Settings - Smart Article Extractor</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f8f9fa;
    }
    
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    h1 {
      color: #2c3e50;
      margin-bottom: 20px;
      text-align: center;
    }
    
    h2 {
      color: #495057;
      margin-top: 30px;
      margin-bottom: 15px;
      border-bottom: 2px solid #e9ecef;
      padding-bottom: 5px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-row {
      display: flex;
      gap: 15px;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .form-row label {
      min-width: 120px;
      font-weight: 500;
      color: #495057;
    }
    
    .form-row input, .form-row select {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      font-size: 14px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #495057;
    }
    
    input[type="text"], input[type="password"], input[type="url"] {
      width: 100%;
      padding: 12px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      font-size: 14px;
      box-sizing: border-box;
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
    }
    
    .help-text {
      font-size: 12px;
      color: #6c757d;
      margin-top: 5px;
    }
    
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      width: 100%;
      margin-top: 10px;
    }
    
    button:hover {
      background: #0056b3;
    }
    
    #status {
      margin-top: 15px;
      padding: 10px;
      border-radius: 4px;
      text-align: center;
      font-weight: 500;
    }
    
    #status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    #status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .example {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      margin-top: 5px;
      font-family: monospace;
      font-size: 12px;
      color: #6c757d;
    }
    
    .mapping-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 6px;
      margin-top: 20px;
    }
    
    .field-type-badge {
      display: inline-block;
      padding: 2px 8px;
      background: #e9ecef;
      border-radius: 12px;
      font-size: 11px;
      color: #495057;
      margin-left: 10px;
    }
    
    .toggle-section {
      margin-bottom: 10px;
    }
    
    .toggle-section input[type="checkbox"] {
      margin-right: 8px;
    }
    
    .preset-field-row {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
      padding: 10px;
      background: white;
      border: 1px solid #e9ecef;
      border-radius: 4px;
    }
    
    .preset-field-row input[type="text"] {
      flex: 1;
      min-width: 120px;
    }
    
    .preset-field-row .field-name {
      flex: 1;
      min-width: 120px;
    }
    
    .preset-field-row .field-value {
      flex: 2;
      min-width: 200px;
    }
    
    .preset-field-row .field-type {
      min-width: 80px;
    }
    
    .preset-field-row .remove-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      min-width: auto;
      width: auto;
    }
    
    .preset-field-row .remove-btn:hover {
      background: #c82333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Smart Article Extractor Settings</h1>
    
    <form>
      <h2>üì° Strapi Connection</h2>
      
      <div class="form-group">
        <label for="strapiUrl">Strapi URL</label>
        <input id="strapiUrl" type="url" placeholder="https://your-strapi-instance.com" />
        <div class="help-text">Enter your Strapi instance URL (including https://)</div>
        <div class="example">Example: https://api.yoursite.com</div>
      </div>
      
      <div class="form-group">
        <label for="collection">Collection Name</label>
        <input id="collection" type="text" placeholder="articles" />
        <div class="help-text">The name of the Strapi collection to save articles to</div>
        <div class="example">Example: articles, posts, content</div>
      </div>
      
      <div class="form-group">
        <label for="token">API Token</label>
        <input id="token" type="password" placeholder="Your Strapi API token" />
        <div class="help-text">API token with write permissions for the collection</div>
        <div class="example">Get this from Strapi Admin ‚Üí Settings ‚Üí API Tokens</div>
      </div>
      
      <h2>üîó Field Mapping</h2>
              <div class="help-text">Map article data to your Strapi collection fields</div>
      
      <div class="mapping-section">
        <div class="toggle-section">
          <input type="checkbox" id="useFieldMapping" />
          <label for="useFieldMapping">Enable custom field mapping</label>
          <div class="help-text">If disabled, will use default field names</div>
        </div>
        
        <div id="fieldMappingConfig" style="display: none;">
          <div class="form-row">
            <label>Title ‚Üí <span class="field-type-badge">Text</span></label>
            <input type="text" id="titleField" placeholder="title" />
          </div>
          
          <div class="form-row">
            <label>Content ‚Üí <span class="field-type-badge">Rich Text/Text</span></label>
            <input type="text" id="contentField" placeholder="content" />
          </div>
          
          <div class="form-row">
            <label>Author ‚Üí <span class="field-type-badge">Text/Relation</span></label>
            <input type="text" id="authorField" placeholder="author" />
          </div>
          
          <div class="form-row">
            <label>Publish Time ‚Üí <span class="field-type-badge">Text/DateTime</span></label>
            <input type="text" id="publishTimeField" placeholder="publishTime" />
          </div>
          
          <div class="form-row">
            <label>Digest ‚Üí <span class="field-type-badge">Text</span></label>
            <input type="text" id="digestField" placeholder="digest" />
          </div>
          
          <div class="form-row">
            <label>Source URL ‚Üí <span class="field-type-badge">Text</span></label>
            <input type="text" id="sourceUrlField" placeholder="sourceUrl" />
          </div>
          
          <div class="form-row">
            <label>Images ‚Üí <span class="field-type-badge">JSON/Relation</span></label>
            <input type="text" id="imagesField" placeholder="images" />
          </div>
          
          <div class="form-row">
            <label>Slug ‚Üí <span class="field-type-badge">UID</span></label>
            <input type="text" id="slugField" placeholder="slug" />
          </div>
          
          <div style="margin-top: 15px; padding: 10px; background: #e7f3ff; border-left: 4px solid #0066cc; border-radius: 4px;">
            <h4 style="margin: 0 0 10px 0; color: #0066cc;">üìä Enhanced Metadata Fields (New!)</h4>
            <div class="help-text" style="margin-bottom: 10px;">Additional metadata extracted from web pages, inspired by Obsidian Clipper</div>
            
            <div class="form-row">
              <label>Site Name ‚Üí <span class="field-type-badge">Text</span></label>
              <input type="text" id="siteNameField" placeholder="siteName" />
              <div class="help-text" style="font-size: 11px;">Website name (e.g., "ÂæÆ‰ø°ÂÖ¨‰ºóÂè∑", "Áü•‰πé‰∏ìÊ†è")</div>
            </div>
            
            <div class="form-row">
              <label>Language ‚Üí <span class="field-type-badge">Text</span></label>
              <input type="text" id="languageField" placeholder="language" />
              <div class="help-text" style="font-size: 11px;">Content language (e.g., "zh-CN", "en")</div>
            </div>
            
            <div class="form-row">
              <label>Tags/Keywords ‚Üí <span class="field-type-badge">JSON/Text</span></label>
              <input type="text" id="tagsField" placeholder="tags" />
              <div class="help-text" style="font-size: 11px;">Extracted tags and keywords as JSON array</div>
            </div>
            
            <div class="form-row">
              <label>Reading Time ‚Üí <span class="field-type-badge">Number</span></label>
              <input type="text" id="readingTimeField" placeholder="readingTime" />
              <div class="help-text" style="font-size: 11px;">Estimated reading time in minutes</div>
            </div>
            
            <div class="form-row">
              <label>Created At ‚Üí <span class="field-type-badge">DateTime</span></label>
              <input type="text" id="createdField" placeholder="extractedAt" />
              <div class="help-text" style="font-size: 11px;">Timestamp when content was extracted</div>
            </div>
          </div>
        </div>
      </div>
      
      <h2>üéØ Field Presets</h2>
      <div class="help-text">Set default values for specific fields that will be automatically applied to all articles</div>
      
      <div class="mapping-section">
        <div class="toggle-section">
          <input type="checkbox" id="useFieldPresets" />
          <label for="useFieldPresets">Enable field presets</label>
          <div class="help-text">Automatically set predefined values for selected fields</div>
        </div>
        
        <div id="fieldPresetsConfig" style="display: none;">
          <div style="margin-bottom: 15px; padding: 10px; background: #e7f3ff; border-left: 4px solid #0066cc; border-radius: 4px;">
            <div class="help-text" style="color: #0066cc; font-weight: 500;">üí° Tips:</div>
            <div class="help-text" style="margin-top: 5px;">‚Ä¢ Only fields with values will be applied</div>
            <div class="help-text">‚Ä¢ Preset values will override any extracted values</div>
            <div class="help-text">‚Ä¢ Use field names from your Strapi collection (not the mapped names)</div>
          </div>
          
          <div id="presetFieldsList">
            <!-- Preset fields will be dynamically generated here -->
          </div>
          
          <button type="button" id="addPresetField" style="background: #28a745; padding: 8px 16px; font-size: 13px; margin-top: 10px;">+ Add Preset Field</button>
        </div>
      </div>
      
      <h2>‚öôÔ∏è Advanced Settings</h2>
      
      <div class="form-group">
        <div class="form-row">
          <label>Content Max Length</label>
          <input type="number" id="maxContentLength" value="50000" min="1000" max="200000" />
          <div class="help-text">Maximum character length for content field</div>
        </div>
        
        <div class="form-row">
          <label>Max Images</label>
          <input type="number" id="maxImages" value="10" min="1" max="50" />
          <div class="help-text">Maximum number of images to process</div>
        </div>
        
        <div class="toggle-section">
          <input type="checkbox" id="generateSlug" checked />
          <label for="generateSlug">Auto-generate slug from title</label>
        </div>
        
        <div class="toggle-section">
          <input type="checkbox" id="uploadImages" checked />
          <label for="uploadImages">Upload images to Strapi</label>
        </div>
        
        <div style="margin-left: 20px; padding: 10px; background: #f0f9ff; border-left: 4px solid #0ea5e9; border-radius: 4px;">
          <h4 style="margin: 0 0 10px 0; color: #0ea5e9;">üñºÔ∏è Êô∫ËÉΩÂõæÁâáÂ§ÑÁêÜËÆæÁΩÆ (Enhanced!)</h4>
          
          <div class="toggle-section">
            <input type="checkbox" id="enableImageCompression" checked />
            <label for="enableImageCompression">ÂêØÁî®ÂõæÁâáÂéãÁº©‰ºòÂåñ</label>
            <div class="help-text">Êô∫ËÉΩÂéãÁº©ÂõæÁâá‰ª•ËäÇÁúÅÁ©∫Èó¥ÂíåÊèêÈ´òÂä†ËΩΩÈÄüÂ∫¶</div>
          </div>
          
          <div class="form-row">
            <label>ÂõæÁâáË¥®Èáè (0.1-1.0)</label>
            <input type="number" id="imageQuality" value="0.8" min="0.1" max="1.0" step="0.1" />
            <div class="help-text">ÂéãÁº©Ë¥®ÈáèÔºå1.0‰∏∫ÊúÄÈ´òË¥®ÈáèÔºå0.1‰∏∫ÊúÄÂ∞èÊñá‰ª∂</div>
          </div>
          
          <div class="form-row">
            <label>ÊúÄÂ§ßÂÆΩÂ∫¶ (px)</label>
            <input type="number" id="maxImageWidth" value="1200" min="300" max="2000" />
            <div class="help-text">ÂõæÁâáÊúÄÂ§ßÂÆΩÂ∫¶ÔºåË∂ÖËøá‰ºöÁ≠âÊØî‰æãÁº©Êîæ</div>
          </div>
          
          <div class="form-row">
            <label>ÊúÄÂ§ßÈ´òÂ∫¶ (px)</label>
            <input type="number" id="maxImageHeight" value="800" min="200" max="1500" />
            <div class="help-text">ÂõæÁâáÊúÄÂ§ßÈ´òÂ∫¶ÔºåË∂ÖËøá‰ºöÁ≠âÊØî‰æãÁº©Êîæ</div>
          </div>
          
          <div class="toggle-section">
            <input type="checkbox" id="smartImageReplace" checked />
            <label for="smartImageReplace">Êô∫ËÉΩÂõæÁâáÈìæÊé•ÊõøÊç¢</label>
            <div class="help-text">Ëá™Âä®ÊõøÊç¢ÊñáÁ´†ÂÜÖÊâÄÊúâÂõæÁâáÈìæÊé•‰∏∫StrapiÂú∞ÂùÄ</div>
          </div>
          
          <div class="toggle-section">
            <input type="checkbox" id="retryFailedImages" checked />
            <label for="retryFailedImages">Â§±Ë¥•ÂõæÁâáÈáçËØïÊú∫Âà∂</label>
            <div class="help-text">Ëá™Âä®ÈáçËØïÂ§±Ë¥•ÁöÑÂõæÁâá‰∏ãËΩΩÂíå‰∏ä‰º†</div>
          </div>
        </div>
        
        <div class="toggle-section">
          <input type="checkbox" id="sanitizeContent" checked />
          <label for="sanitizeContent">Clean HTML content</label>
        </div>
        
        <div class="toggle-section">
          <input type="checkbox" id="enableCleanupRules" checked />
          <label for="enableCleanupRules">Enable DOM cleanup rules</label>
          <div class="help-text">Automatically remove ads, navigation, and noise elements</div>
        </div>
        
        <div class="form-row">
          <label>Custom Cleanup Rules</label>
          <textarea id="customCleanupRules" rows="10" placeholder='Add custom cleanup rules in JSON format, e.g.:
[
  {"type": "id", "value": "content_bottom_area", "description": "Bottom content area"},
  {"type": "class", "value": "advertisement", "description": "Ad sections", "domains": ["example.com"]},
  {"type": "selector", "value": "div[data-ad]", "description": "Data-ad divs", "domains": ["*.google.com"]},
  {"type": "class", "value": "popup", "description": "All popups"}
]

Supported types: id, class, tag, selector, regex-class
Optional domains: ["domain.com", "*.subdomain.com"] (leave empty for all domains)'></textarea>
          <div class="help-text">JSON array of cleanup rules. Each rule needs: type, value, description</div>
        </div>
        
        <div class="toggle-section">
          <input type="checkbox" id="includeBlocksField" checked />
          <label for="includeBlocksField">Include blocks field (for Dynamic Zone)</label>
          <div class="help-text">Enable if your Strapi collection has a required blocks field</div>
        </div>
        
        <div class="toggle-section">
          <input type="checkbox" id="putContentInBlocks" />
          <label for="putContentInBlocks">Put article content in first blocks item</label>
          <div class="help-text">Store full article content as rich text block in Dynamic Zone</div>
        </div>
        
        <div class="form-row" style="margin-left: 20px; display: none;" id="blocksComponentConfig">
          <label>Blocks Component Name</label>
          <input type="text" id="blocksComponentName" placeholder="blocks.rich-text" />
          <div class="help-text">The component name for rich text blocks in your Dynamic Zone</div>
        </div>
      </div>
      
      <button type="button" id="save">Save Settings</button>
      
      <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
        <button type="button" id="debug" style="background: #6c757d;">Show Current Settings</button>
        <button type="button" id="testData" style="background: #28a745;">Test Data Generation</button>
        <button type="button" id="backup" style="background: #17a2b8; color: white;" title="üíæ ‰∏ãËΩΩÂΩìÂâçËÆæÁΩÆÁöÑÂ§á‰ªΩÊñá‰ª∂">üíæ Backup Settings</button>
        <input type="file" id="restoreFile" accept=".json" style="display: none;" />
        <button type="button" id="restore" style="background: #fd7e14; color: white;" title="üìÇ ‰ªéÂ§á‰ªΩÊñá‰ª∂ÊÅ¢Â§çËÆæÁΩÆ">üìÇ Restore Settings</button>
        <button type="button" id="reset" style="background: #dc3545; border: 2px solid #c82333; font-weight: bold;" title="‚ö†Ô∏è Ê≠§Êìç‰ΩúÂ∞ÜÂà†Èô§ÊâÄÊúâÈÖçÁΩÆÊï∞ÊçÆ‰∏î‰∏çÂèØÊí§ÈîÄÔºÅ">‚ö†Ô∏è Reset All Settings</button>
      </div>
      
      <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; color: #856404; font-size: 13px;">
        <strong>‚ö†Ô∏è ÈáçÁΩÆË≠¶ÂëäÔºö</strong>Reset All Settings ÊåâÈíÆÂ∞ÜÊ∞∏‰πÖÂà†Èô§ÊâÄÊúâÈÖçÁΩÆÔºåÂåÖÊã¨ Strapi URL„ÄÅToken„ÄÅÂ≠óÊÆµÊò†Â∞ÑÂíåËá™ÂÆö‰πâËßÑÂàô„ÄÇËØ∑Ë∞®ÊÖéÊìç‰ΩúÔºÅ
      </div>
      
      <div id="debugOutput" style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-family: monospace; font-size: 12px; display: none;"></div>
      
      <div id="status"></div>
    </form>
  </div>
  
  <script src="options.js"></script>
</body>
</html>
